@using System.Diagnostics
@using System.Text.Json

<Button OnClick=SerializeTest>Serialize Test</Button>

<ItemSelect Label="Datapoints" Items=points @bind-SelectedValue=pointsToLoad Changed=LoadData />



<ApexChart TItem="TimeSeries"
           Title="Value"
           Height="150"
           XAxisType="XAxisType.Datetime"
           Debug @ref=chart>

    <ApexPointSeries TItem="TimeSeries"
                     Items="data"
                     Name="Value"
                     SeriesType="SeriesType.Line"
                     XValue="@(e => e.Date)"
                     YValue="@( e=> e.Value)"
                     OrderBy="e=>e.X"
                     Stroke="@(new SeriesStroke { Width = 2, Color="#1F15E5"})" />
</ApexChart>

@message

@code {


    private ApexChart<TimeSeries> chart;
    private List<int> points = new List<int> { 100, 1000, 5000, 10000 };
    private int pointsToLoad = 100;
    private IEnumerable<TimeSeries> data = new TimeSeriesGenerator(100).TimeSeries;
    private string message;

    private async Task LoadData()
    {
        data = new TimeSeriesGenerator(pointsToLoad).TimeSeries;
        await Task.Delay(10);
        var sw = new Stopwatch();
        sw.Start();
        await chart.UpdateSeries(false);
        sw.Stop();

        message = $"Update {sw.ElapsedMilliseconds.ToString("N")}ms";
    }

    private void SerializeTest()
    {
        var series = chart.Options.Series;
        
        //var series = new Series<TimeSeries>();
        //series.Name = "kolla";

        //var dataPoints = new List<IDataPoint<TimeSeries>>();
        //for (var i = 0; i < pointsToLoad; i++)
        //{
        //    dataPoints.Add(new DataPoint<TimeSeries> { Y = 100000, X = $"index {i}" });
        //}
        //series.Data = dataPoints;
        var options = new ChartSerializer().GetOptions<TimeSeries>();

      
        var sw = new Stopwatch();
        sw.Start();

       // var result = serializer.
        var result = System.Text.Json.JsonSerializer.Serialize(series, options);
        sw.Stop();
        message = $"Test [{pointsToLoad}] {sw.ElapsedMilliseconds.ToString("N")}ms";

    }



    }